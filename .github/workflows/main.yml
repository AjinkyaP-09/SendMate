# .github/workflows/main.yml

name: Build and Deploy Sendmate

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # ... (steps for checkout, docker build, terraform) ...

      # STEP 3: Configure and deploy with Ansible
      - name: Run Ansible Playbook
        uses: dawidd6/action-ansible-playbook@v2
        with:
          playbook: playbook.yml
          directory: ./ansible
          key: ${{ secrets.EC2_SSH_PRIVATE_KEY }}
          inventory: |
            [all]
            ${{ steps.terraform_apply.outputs.public_ip }}
          extra_vars: |
            dockerhub_username=${{ secrets.DOCKERHUB_USERNAME }}
            mongo_uri=${{ secrets.MONGO_URI }}
            google_client_id=${{ secrets.GOOGLE_CLIENT_ID }}
            google_client_secret=${{ secrets.GOOGLE_CLIENT_SECRET }}
            aws_access_key_id=${{ secrets.AWS_ACCESS_KEY_ID }}
            aws_secret_access_key=${{ secrets.AWS_SECRET_ACCESS_KEY }}
            aws_region=${{ secrets.AWS_REGION }}
            aws_bucket_name=${{ secrets.AWS_BUCKET_NAME }}
